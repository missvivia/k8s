apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: store-front
  namespace: store
  labels:
    project: store
    app: store-front
spec:
  replicas: 3 #å‰¯æœ¬æ•°é‡
  minReadySeconds: 30 #æ»šåŠ¨å‡çº§æ—¶ï¼Œå®¹å™¨å‡†å¤‡å°±ç»ªæ—¶é—´æœ€å°‘ä¸º30s
  strategy:
    type: recreate #å‡çº§æ–¹å¼, å…¨éƒ¨åˆ æ‰Podsåå†å…¨éƒ¨é‡æ–°åˆ›å»ºï¼ŒæœŸé—´æœåŠ¡ä¼šä¸å¯ç”¨
    #rollingUpdate:##ç”±äºreplicasä¸º3,åˆ™æ•´ä¸ªå‡çº§,podä¸ªæ•°åœ¨2-4ä¸ªä¹‹é—´
    #  maxSurge: 3 #æ»šåŠ¨å‡çº§æ—¶ä¼šå…ˆå¯åŠ¨3ä¸ªpod
    #  maxUnavailable: 1 #æ»šåŠ¨å‡çº§æ—¶å…è®¸çš„æœ€å¤§Unavailableçš„podä¸ªæ•°
  selector:
    matchLabels:
      project: store
      app: store-front
  template:
    metadata:
      labels:
        project: store
        app: store-front
    spec:
      terminationGracePeriodSeconds: 60 ##k8så°†ä¼šç»™åº”ç”¨å‘é€SIGTERMä¿¡å·ï¼Œå¯ä»¥ç”¨æ¥æ­£ç¡®ã€ä¼˜é›…åœ°å…³é—­åº”ç”¨,é»˜è®¤ä¸º30ç§’
      #hostNetwork: true # æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæˆ–è€…æ˜¯k8sè‡ªæœ‰ç½‘ç»œ
      #nodeName: yun1 # æŒ‡å®šè¦éƒ¨ç½²æ‰€åœ¨çš„èŠ‚ç‚¹ï¼Œè¿™ç§æ–¹å¼å¯ä»¥å¿½è§†èŠ‚ç‚¹ä¸Šå®šä¹‰çš„æ±¡ç‚¹(taint)
      containers:
      - name: store-front
        image: yun.rep:5000/store-front
        imagePullPolicy: Always # Always, Never, IfNotPresent
        command: ["java"]
        args: ["-jar", "/store-front.jar","--spring.profiles.active=docker2","--eureka01.host=eureka01","--eureka01.port=8001","--eureka02.host=eureka02","--eureka02.port=8002","--eureka03.host=eureka03","--eureka03.port=8003"]
        ports:
        - containerPort: 8800 # åªåœ¨ğŸ‰‘ï¸k8så†…éƒ¨ç½‘ç»œä¸­å¯ä»¥è®¿é—®çš„ç«¯å£
          hostPort: 8800  #å°†ç«¯å£æš´éœ²ç»™å¤–éƒ¨ç½‘ç»œ
          name: http
          protocol: TCP
        resources:
          requests:
            cpu: 0.05  #
            memory: 16Mi  #
          limits:
            cpu: 0.1
            memory: 32Mi
        livenessProbe:   # å­˜æ´»æ¢é’ˆ: ç”¨äºæ£€æµ‹å®¹å™¨æ˜¯å¦å­˜æ´»ï¼Œä»è€Œå¯¹å®¹å™¨æ‰§è¡Œé‡å¯ç­–ç•¥ã€‚
          httpGet:
            path: /healthz
            port: 8800
            scheme: HTTP
          initialDelaySeconds: 30
          timeoutSeconds: 5
          successThreshold: 1
          failureThreshold: 5
        readinessProbe:    # å°±ç»ªæ¢é’ˆ: å†³å®šæ˜¯å¦å¯ä»¥æ¥æ”¶æ¥è‡ªserviceçš„æµé‡ã€‚
          httpGet:
            path: /healthz
            port: 8800
            scheme: HTTP
          initialDelaySeconds: 30
          timeoutSeconds: 5
          successThreshold: 1
          failureThreshold: 5
        imagePullSecrets:
        - name: yun.rep.password # å­˜æ”¾ç§ç”¨ä»“åº“çš„ç™»å½•åå’Œå¯†ç 